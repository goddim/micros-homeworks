
# Домашнее задание к занятию «Микросервисы: принципы»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.

## Задача 1: API Gateway 

Предложите решение для обеспечения реализации API Gateway. Составьте сравнительную таблицу возможностей различных программных решений. На основе таблицы сделайте выбор решения.

Решение должно соответствовать следующим требованиям:
- маршрутизация запросов к нужному сервису на основе конфигурации,
- возможность проверки аутентификационной информации в запросах,
- обеспечение терминации HTTPS.

Обоснуйте свой выбор.

# Ответ

Для реализации API Gateway в микросервисной архитектуре можно рассмотреть несколько популярных решений: NGINX, Kong, Apigee, и AWS API Gateway. Эти решения отличаются по функциональности, производительности и удобству использования. Ниже приведена сравнительная таблица возможностей этих решений с учетом требований:

| **Функция / Решение**     | **NGINX**        | **Kong**           | **Apigee**         | **AWS API Gateway** |
|---------------------------|------------------|---------------------|--------------------|---------------------|
| Маршрутизация запросов    | Да               | Да                  | Да                 | Да                  |
| Аутентификация            | Плагинами        | Встроено            | Встроено           | Встроено            |
| Терминация HTTPS          | Да               | Да                  | Да                 | Да                  |
| Масштабируемость          | Высокая          | Высокая             | Высокая            | Высокая             |
| Поддержка плагинов        | Ограничена       | Широкая             | Ограничена         | Нет                 |
| Управление API            | Ограничено       | Да                  | Да                 | Да                  |
| Легкость интеграции       | Средняя          | Высокая             | Высокая            | Высокая             |
| Стоимость                 | Низкая (open-source) | Средняя (open-source + enterprise) | Высокая             | Средняя/Высокая     |
| Поддержка различных протоколов | HTTP/HTTPS | HTTP/HTTPS + TCP/UDP | HTTP/HTTPS         | HTTP/HTTPS          |
| Сообщество и поддержка    | Широкое          | Широкое             | Среднее            | Широкое             |

### Обоснование выбора
Исходя из требований и сравнительной таблицы, наиболее подходящим решением для реализации API Gateway является Kong. Вот несколько причин для такого выбора:

### Маршрутизация запросов:

Kong предлагает гибкие возможности маршрутизации запросов на основе конфигурации.

### Аутентификация:

Kong имеет встроенную поддержку различных методов аутентификации и авторизации, таких как JWT, OAuth2, Basic Auth и другие. Это упрощает интеграцию с существующими системами безопасности.

###Терминация HTTPS:

Kong обеспечивает терминацию HTTPS, что позволяет безопасно обрабатывать запросы.

###Масштабируемость и производительность:

Kong хорошо масштабируется и обеспечивает высокую производительность благодаря своей архитектуре, основанной на NGINX и Lua.

### Поддержка плагинов:

Широкий набор доступных плагинов позволяет легко расширять функциональность Kong, что обеспечивает гибкость при изменении требований.

### Управление API:

Встроенные возможности управления API позволяют отслеживать и контролировать использование API, что важно для обеспечения стабильности и безопасности системы.
Стоимость:

Kong имеет бесплатную версию с открытым исходным кодом и коммерческую версию с дополнительными возможностями, что делает его доступным для разных бюджетов.
Таким образом, Kong представляет собой мощное и гибкое решение для реализации API Gateway, удовлетворяющее всем указанным требованиям и обладающее широкими возможностями для дальнейшего расширения и настройки.

## Задача 2: Брокер сообщений

Составьте таблицу возможностей различных брокеров сообщений. На основе таблицы сделайте обоснованный выбор решения.

Решение должно соответствовать следующим требованиям:
- поддержка кластеризации для обеспечения надёжности,
- хранение сообщений на диске в процессе доставки,
- высокая скорость работы,
- поддержка различных форматов сообщений,
- разделение прав доступа к различным потокам сообщений,
- простота эксплуатации.

Обоснуйте свой выбор.

## Ответ

Для выбора подходящего брокера сообщений, удовлетворяющего указанным требованиям, рассмотрим несколько популярных решений: Apache Kafka, RabbitMQ, Apache Pulsar и NATS. Вот сравнительная таблица возможностей этих брокеров сообщений:

| **Функция / Решение**           | **Apache Kafka**   | **RabbitMQ**       | **Apache Pulsar**  | **NATS**           |
|---------------------------------|--------------------|--------------------|--------------------|--------------------|
| Поддержка кластеризации         | Да                 | Да                 | Да                 | Да                 |
| Хранение сообщений на диске     | Да                 | Да                 | Да                 | Опционально        |
| Высокая скорость работы         | Очень высокая      | Высокая            | Очень высокая      | Очень высокая      |
| Поддержка различных форматов    | Да                 | Да                 | Да                 | Да                 |
| Разделение прав доступа         | Да (через ACL)     | Да (через ACL)     | Да (Role-Based Access Control) | Ограниченная     |
| Простота эксплуатации           | Средняя            | Высокая            | Средняя            | Высокая            |

### Обоснование выбора
Исходя из требований и сравнительной таблицы, наиболее подходящим решением является Apache Kafka. Вот несколько причин для такого выбора:

### Поддержка кластеризации:

Apache Kafka обеспечивает надежную поддержку кластеризации, что позволяет строить отказоустойчивые и масштабируемые системы.

### Хранение сообщений на диске:

Kafka хранит все сообщения на диске, что гарантирует их доставку и позволяет восстанавливать данные в случае сбоев.

### Высокая скорость работы:

Kafka оптимизирован для высокой пропускной способности и низкой задержки, что делает его идеальным для обработки большого объема данных в реальном времени.

### Поддержка различных форматов сообщений:

Kafka поддерживает любые форматы сообщений, включая JSON, Avro, Protobuf и другие, что обеспечивает гибкость при интеграции с различными системами.

### Разделение прав доступа:

Kafka имеет встроенную поддержку контроля доступа с использованием ACL (Access Control Lists), что позволяет точно настраивать права доступа для различных пользователей и сервисов.

### Простота эксплуатации:

Хотя Kafka требует некоторых усилий для настройки и администрирования, существует множество инструментов и документации, упрощающих эту задачу. Кроме того, сообщество Apache Kafka активно развивается и предоставляет поддержку.

###  Заключение
Apache Kafka является наиболее подходящим решением для построения системы на основе микросервисной архитектуры с использованием брокера сообщений. Его высокая производительность, надежность, поддержка различных форматов сообщений и возможности кластеризации делают его оптимальным выбором для масштабируемой и надежной системы.
